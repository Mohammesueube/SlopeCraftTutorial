%\documentclass[UTF8]{ctexart}
\documentclass{article}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{verbatim}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage[colorlinks,linkcolor=blue]{hyperref}
\usepackage{listings}
\usepackage{fontspec}
\setmonofont{Consolas}
\usepackage{color}
\usepackage{xcolor}
\graphicspath{{./Images/}}

\geometry{papersize={210mm,297mm}}
\geometry{left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm}

\setlength{\headheight}{13pt}

\title{SlopeCraft v3.6 UserGuide}
\author{TokiNoBug}
\date{\today}

\begin{comment}
\pagestyle{fancy}

\lhead{\author}
\chead{\title}
\rhead{\date}

\lfoot{}
\cfoot{\thepage}
\rfoot{}

\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\headwidth}{\textwidth}
\renewcommand{\footrulewidth}{0pt}

\end{comment}

\begin{document}
    \maketitle
    %%%%%%%%%%%%%%%%%%%%%%%
    % Page1
    %%%%%%%%%%%%%%%%%%%%%%%
    SlopeCraft is such a great update that the whole software is rewritten again with Many hardcore functions implemented and lots of bugs fixed. In this version, lossy compression is added to compress total height of a 3D map to almost any arbitrary value, which entirely sloves the problem that 3D map often got higher than the world. Also, glassbridge is added in order to assitant player when building.
    
    Besides, ui is slightly changed. Since the last tutorial is for v3.1, it's necessary to write a new user guide.

    By the way, this tutorial is not a fool-type one, only those must be introduced are introduced and those must be underlined are underlined. If any question, view a previous tutorial.

    %%%%%%%%%%%%%%%%%%%%%%%
    % Page2
    %%%%%%%%%%%%%%%%%%%%%%%
    \pagebreak
    \section{Update Summary}
    \paragraph{New Contents}

    \textbf{SlopeCraftL3.dll}——The kernel of SlopeCraft is developed into a dynamic linked library through a interface class, including core functions of 3d, flat, file-only and wall maps. Theoretically, this lib can be called by not only C++ but also Java and Python and so on.(When it comes to other languages, one more layer of interface might be required). Future plugins will have one more choice.

    \paragraph{New Functions}
    \begin{enumerate}
        \item The 61th basecolor
        \item Intelligent lossy compression
        \item Glassbridge construction——\textbf{Easy to build 3d maps}
        \item Fireproof and enderman-proof——cover vulnerable blocks with glass.
        \item Export as .NBT format——Minecraft structure block format.
        \item All kinds of \textbf{Upper slabs} to blocklist.
        \item Customizable blocklist——add any block if you like.
        \item Preview map when constructing 3d structure——\textbf{Lossy compression may edit it slightly}
        \item Check for updates and report bugs——by subject to \href{https://github.com/ToKiNoBug/SlopeCraft}{repository on GitHub}.
        \item More complete error-reporing function.
        \item Reset language automatically when starting——if Chinese isn't found in system language, English instead.
        \item settings.json——config files for starting.
        \item New map type: wall maps——kind of weird but requested for many times.
    \end{enumerate}
    \paragraph{Bug Fixed}
    \begin{enumerate}
        \item Fixed the bug that may colors can't be disabled.
    \end{enumerate}
    \paragraph{Optimization and Other Changes}
    \begin{enumerate}        
        \item Optimized the performance of converting and constructing glassbridge.
        \item Deleted unnecessary \textbf{Confirm} buttons. Less opeartions required now.
        \item Progessbars are no longer in busy state when waitting for user's operation. More suited for users now.
    \end{enumerate}

    \pagebreak
    %%%%%%%%%%%%%%%%%%%%%%%
    % Page3
    %%%%%%%%%%%%%%%%%%%%%%%
    \section{Junior Tutorial}
    \subsection{Import Image}
    From the previous tutorial to now, the greatest change is still a new button \textbf{Settings}, which is used to process transparent pixels better.
 
    Click \textbf{Settings} and you will see a subwindow as figure \ref*{SetTPS}.

    \begin{figure}[htbp]
        \centering
        \includegraphics[width=15cm]{Img1_TPS.png}
        \caption{Subwindow to set transparence processing strategy}
        \label{SetTPS}
    \end{figure}
    
    \textbf{Note: If you want to import a image with transparency under custom transparency processing strategy, you must set the strategy first and then import you image! Otherwise the image will only be preprocessed by the default strategy! If you set the strategy after having your image imported, import you image again.}

    We have various method to deal with full-transparent pixels(alpha=0) and semitransparent pixels(alpha>0). The former are either replaced with background color or air block, while the latter have 3 choices: to be replaced with background color, to be composed with background color, or to be taken as non-transparent pixel by ignoring its alpha channel. Besides, the background color is also customizable. In default it's light gray.

    Please note that each \textbf{pixel corresponds to a block in map}. Since the width and height are recommended to be any \textbf{multiple of 128 pixels}, you should better cut and scale you image before importing into SlopeCraft.(Recommended but not forced) This preprocessing should be done by user instead of software, so I don't and won't implement such function in SlopeCraft. As a result, there is not any resizing or scaling operation in SlopeCraft, \textbf{each pixel} shall be reflected faithfully.

    \subsection{Set Map Type}
    The only modification is that a new kind of map (wall maps) is added. You just need to choose the right map type and game version following the description on ui, then turn to the next page.

    The 61th base color: GLOWING\_LICHEN is complemented to the blocklist page. Actually it was already added in Minecraft v1.17 but I left it in SlopeCraft v3.5.1.

    The logic of block list: a disabled checkbox or radiobutton mean locked or unchangeable, for example, basecolor 0(air) must be enabled. SlopeCraft requires that each basecolor must have a block eventhough the basecolor is disabled. Thus, if a basecolor has only one available block, that single radiobutton will fixed.
    
    If a block's version is later than the game version, is will also be disabled. Note that not all block can be used in wall maps, like iron pressure plate and glowing lichen. In such condition, it's not only properties of basecolors and maps themselves but also your selected blocks that restrict your available color count.

    \subsection{Color Convertion}
    There's no modification on the page of convertion. Just operate like before.
    
    First, select a converting algorithm, then set whether to enable dithering or not. Then click \textbf{Convert}, after the convertion is finished, export in the way you want.

    The 6 converting algorithms respectively correspond to 6 different color difference formulations. Among them, RGB+ is best recommended, RGB and XYZ have best speed while Lab94 and Lab00 have releatively good effect but are slow in speed. The HSV algorithm hasn't been working well for a long time, so it's not recommended.
    
    Dithering uses Floyd-Steinberg algorithm, it tries to fit the orignal image better through mixing several similar colors.
    
    Here we take picture drawn by \href{https://t.bilibili.com/544583492149793294}{Lancet\_Corgi} as an instance(Thanks to Lancet\_Corgi, here's \href{https://space.bilibili.com/37171000}{his homepage on BiliBili})
    
    \begin{figure}[htbp]
        %\addtocounter{figure}{-1}
        \centering
        \setcounter{subfigure}{0}
        \subfigure[Before Convertion]{
            \begin{minipage}[t]{7cm}
                \centering
                \includegraphics[width=6cm]{Img3_Raw.png}                
                \label{ruby_raw}
            \end{minipage}
        }
        \subfigure[After Convertion]{
            \begin{minipage}[t]{7cm}
                \centering
                \includegraphics[width=6cm]{Img4_Converted.png}
                %\caption{转化后}
                \label{ruby_converted}
            \end{minipage}
        }
        \caption{Convert using RGB+(dithering disabled)}
    \end{figure}
    
    \subsection{Export 3D structure}
    If you hope to save the map in \textbf{.Litematic}(for Litematica mod) or \textbf{.nbt}(for Minecraft strcuture block) format, you should click \textbf{Build 3D} and then \textbf{Export}. When finished building, SlopeCraft will send you a preview window where you can see the material list and map.

    \begin{figure}[htbp]
        \centering
        \includegraphics[width=15cm]{Img2_Export3D.png}
        \caption{Interface of Exporing 3D}
    \end{figure}

    In this interface, \textbf{Intelligent Lossy Compress} and \textbf{Construct Glass Bridge} are added. And some other options like \textbf{Fire Proof} and \textbf{Enderman Proof} are added. A new sub progress bar is used to show the progress of lossy compression and construction of glass bridge.
        
    \subsubsection{Compression}
    Simply put, lossless compression is to compress the total height of 3D map at the cost of consecutiveness while \textbf{keeping colors of each pixel strictly unchanged}. It's a really rigorous restriction so it may fail to reach your expectation. It's no exaggeration to say that some images are mathematically uncompressable, like full-white parts. Then new compress technology is required: intelligent lossy compression.

    Different with the lossless one, lossy compression compress by \textbf{slightly modifying some pixel}, to make the total height no greater than the maximum allowed height(MAH) which is assigned by you. Genetic algorithm, which belongs to swarm intelligence, is employed to implement lossy compression. So you can see it's a speacial part of SlopeCraft with most technical content. The MAH should be no less than 14, otherwise your 3D map still have some probability of failing to be compressed.

    In general, the less MAH is, the more quality loss in your map. For example, is this map is made into a 3D map, its height will be 255. Now we compress it with both lossy and lossless algorithm. Firgue \ref*{ruby_max100} shows the result when MAH=100, and \ref*{ruby_max20} shows when MAH=20.

    \begin{figure}[htbp]
        \centering
        \subfigure[MAH=100]{
            \begin{minipage}[t]{7cm}            
                \centering
                \includegraphics[width=6cm]{Img6_Compressed_100.png}
                \label{ruby_max100}
            \end{minipage}
        }
        \subfigure[MAH=20]{
            \begin{minipage}[t]{7cm}
                \centering
                \includegraphics[width=6cm]{Img5_Compressed_20.png}
                \label{ruby_max20}
            \end{minipage}
        }
        \caption{MAH's effect to picture quality}
    \end{figure}

    There's no obvious difference before and after the compression. But you can still find that some gray dots appear on the left and right side. You can learn that the number of gray dots has a negative relation with MAH. Otherwise, as genetic algorithm is a stochastic optimizing algorithm, there's some randomness in which pixel will be modified and regular pattern won't appear.

    Lossy and lossless compression can be used either together or respectively. But in general, if you have already enabled lossy one, there's no way to disable the lossless one. Lossy compression without lossless will make a lot more pixels modified, bringing more quality loss, while the lossless counterpart make the compression be finished with less pixel modified and less quality loss.
    
    You can choose these options with flat map or wall map, but they \textbf{won't take any result}.

    \subsubsection{Construct the Glass Bridge}
    Each horizontal slice 3D map consists of seperated blocks, which is really hard to build. Connecting these blocks will obviously make a map easier to be built. Glassbridge is what we used to connect these blocks to form a pathway to assist players.
    
    It's definatly that the glass bridge will lead to more glass consumption, so it's deprecated to construct it in each layer of 3D map. In default, SlopeCraft constructs once in each 5 layers, and that interval can be modified. A too large interval will decrease the effect while a too small interval is a waste of glass.
    
    For any details about compression and glass bridge, read \href{https://github.com/ToKiNoBug/SlopeCraftTutorial/blob/main/BasicPrinciple/Principle%20of%20map%20pixel%20arts.md}{Principle of Map Arts}.

    \href{https://github.com/AbrasiveBoar902}{AbrasiveBoar902} made great contributions to the performance of constructing glass bridge, sincere thanks to AbrasiveBoar902.

    \subsubsection{Fire Proof / Enderman Proof}
    We can learn by name that these functions is added to protect burnable blocks and prevent enderman from stealing blocks in map. The detailed method is to conver every exposed surfaces of these blocks with glass blocks, and it does work. On the other hand it consumes a large amount of glass blocks.

    \subsubsection{Export}
    There are 2 formats supported currently, \textbf{*.Litematic} and \textbf{*.nbt}.

    \begin{figure}[htbp]
        \centering
        \includegraphics[width=15cm]{Img7_SelectFormat.png}
        \caption{Set Export Format}
        \label{setExport3DFormat}
    \end{figure}

    If you hope to save as \textbf{*.nbt} format, it's required to select the correct suffix, like figure \ref*{setExport3DFormat}.

    \subsection{Export as File-Only Map}
    File-only maps have few change compared to previous versions.

    File name of a map data file is like map\_i.dat, where i is an integer no less than 0, like map\_3.dat. \textbf{i is the sequence number of this map data file. Sequence number is the unqiue label of a map data file in Minecraft.} In normal conditons, your exported map data files shouldn't cover any unrelated counterparts, so be careful when setting the beginning sequence number.

    In Minecraft, pressing F3+h will enable you to learn details about an item, including map id, which is the sequence number of a map data file. Figure \ref*{mapItem} shows a map item of map\_6.dat.
   \begin{figure}[htbp]
       \centering
       \includegraphics[height=4cm]{Img8_MapItem.png}
       \caption{Map item and map sequence number}
       \label{mapItem}
   \end{figure}

   \begin{itemize}
       \item Get map using /give command:
       
       The beginning sequence number can be set arbitarary as soon as no unreleated map will be covered.
       起始序号可以随意设置，只要不覆盖掉无关的地图。
       \begin{enumerate}
           \item 1.12 command: /give @s filled\_map 1 i
           \item 1.13+ command: /give @s filled\_map\{map:i\}
       \end{enumerate}
       \item If you want to simply replace map data files instead of using commands:
       \begin{enumerate}
           \item Create n map items correspond to your image where n is the map count, it's 4 in this instance.
           \item Press F3+H to check the map sequence number of map items you've just created, their sequence numbers should be a\textasciitilde(a+n-1), n in total.
           \item Close Minecraft and fill the value of a in the \textbf{Beginning Sequence Number} branket.
           \item Click export and then select data folder under you save. SlopeCraft will replace these map data files. 
           \item Close SlopeCraft and start Minecraft, these map items will be replaced with map pixel arts successfully.
           \item If you are afraid of your misoperation which may lead to unreleated map being covered, you can create a temporary folder and then selected when exporting. Repleace the map data files you want to replace after you're sure that no error occurres.
       \end{enumerate}
   \end{itemize}
   
   \pagebreak
   \section{Advanced Functions}
   Basical function is enough if you just want to use SlopeCraft simply. However, if you want to customize something, you'd better have a look at this section. Using advanced functions usually requires understanding of map arts' principles. It's strongly recommended to read \href{https://github.com/ToKiNoBug/SlopeCraftTutorial/blob/main/BasicPrinciple/Principle%20of%20map%20pixel%20arts.md}{Principle of map pixel arts}.

   \subsection{Customize blocklist}
   If you aren't satisfyed with default blocks, which means that you hope to add other vanilla blocks or mod-blocks, this section will tell you what to do.
   
   \subsubsection{Pre-informations}
   You must master following information first:

   \begin{enumerate}
       \item \textbf{Complete} id of this block, including \textbf{namespace prefix} and \textbf{all block properties}.
       
       For instance, waxed copper slab:
       
       minecraft:waxed\_copper\_slab[type=top,waterlogged=false]

       Here minecraft: is the namespace prefix of vanilla blocks, contents in the brackets are all block properties. For safety reason, you should set a value for every block properties.

       \item The earliest Minecraft version when this block is added.

       SlopeCraft assigned the following numbers as references of several Minecraft versions:
       \begin{table}[h]
        \centering
        \caption{Numbers and versions}
        \label{VerAndRealVer}
        \begin{tabular}{cc}\hline
            Number & Version \\ \hline
            0 & Earlier than 1.12 \\
            12 & 1.12 \\
            13 & 1.13 \\
            14 & 1.14 \\
            15 & 1.15 \\
            16 & 1.16 \\
            17 & 1.17 \\
            255 & Future version \\
            \hline            
        \end{tabular}
       \end{table}

   Usually you shouldn't use 255, it's just a reserved value. If you insist to do so, then everyting will be undefined features ---- I don't know what will happen.

   \item Block id in 1.12.
   
   This property is added simply because a great number of block ids changed from 1.12 to 1.13. If your block doesn't exist in 1.12, or its id kept unchanged, you can fill in an empty string.
   
   \item Base color of this block.
   
   Perhaps the most error prone property, but also the extremely and most important one. For vanilla blocks, view \href{https://minecraft.fandom.com/wiki/Map_item_format}{Minecraft Wiki}. For mod-blocks, measure the basecolor by yourself or ask the mod developer. Asking me will never take effort.
   
   If you don't understand what basecolor is, go to read \href{https://github.com/ToKiNoBug/SlopeCraftTutorial/blob/main/BasicPrinciple/Principle%20of%20map%20pixel%20arts.md}{Principle of map pixel arts}.

   \item Chinese name of block (arbitrary value if you don't speak Chinese).
   \item English name of block
   \item Whether another block is required under this block
   \item Whether the block glows
   \item Whether the block is burnable
   \item Whether the block can be stolen by enderman.
   \item Whether the block is suitable for wall maps(for instance, water and iron pressure plate is not suitable)
   \item Texture image of this block (16*16px png is suggested)  
   \end{enumerate}

   \subsubsection{方块与方块列表}
   SlopeCraft中，方块列表以json格式存储，相关的图片放在FixedBlocks和CustomBlocks文件夹下。
   
   方块列表分为两类：固定方块列表与自定义方块列表。其中固定方块列表是我提供的最基础的一些方块，存储与\textbf{FixedBlocks.json}中（对应的图片在\textbf{FixedBlocks}文件夹下），确保每个基色都存在对应的方块。虽然方块列表中的方块事实上是在程序运行时才确定，但\textbf{你不应该修改它}。
   
   自定义方块列表存储在\textbf{CustomBlocks.json}中，相应的图片在\textbf{CustomBlocks}文件夹下，这是用户自定义的方块列表，允许用户灵活编辑。我在里面写了一些半砖方块，可以作为参考。
   
   每个方块拥有以下属性：
   \begin{table}[h]
    \centering
    \caption{方块的属性}
    \begin{tabular}{ccccc}
        \hline
        属性名 & 类型 & 是否必填 & 默认值 & 说明  \\ \hline
        baseColor & byte & 是 & & 方块的地图基色 \\
        id & string & 是 & & 方块id，包括命名空间和详细方块状态\\
        version & byte & 是 & & 方块最早出现的版本。 \\
        nameZH & string & 是 & & 方块的中文名 \\
        nameEN & string & 是 & & 方块的英文名 \\
        icon & string & 是 & & 方块对应图片的文件名 \\
        idOld & string & 否 & 空字符串 & 方块在1.12的id \\
        needGlass & bool & 否 & false & 指示方块底部是否必须有其他方块 \\
        isGlowing & bool & 否 & false & 指示方块是否发光 \\
        endermanPickable & bool & 否 & false & 指示方块是否可以被末影人偷走 \\
        burnable & bool & 否 & false & 指示方块是否可以被烧毁 \\
        wallUseable & bool & 否 & true & 指示方块是否可以用于墙面像素画 \\
        \hline 
    \end{tabular}       
   \end{table}
   
   \clearpage
   用json格式表示如下：
\begin{lstlisting}[language = C++, numbers=left, 
    numberstyle=\tiny,keywordstyle=\color{blue!70},
    commentstyle=\color{red!50!green!50!blue!50},frame=shadowbox,
    rulesepcolor=\color{red!20!green!20!blue!20},basicstyle=\ttfamily]
{
    "baseColor":11,
    "id":"minecraft:cobblestone_slab[type=top,waterlogged=false]",
    "nameZH":"圆石上半砖",
    "nameEN":"Cobblestone slab",
    "icon":"cobblestone.png",
    "version":0,
    "idOld":"minecraft:stone_slab[half=top,variant=cobblestone]"
}
    \end{lstlisting}
    上面这段json信息展示了一个圆石上半砖的方块信息，解析如下：

    \begin{enumerate}
        \item 它的基色是11，这也是圆石、石砖、石头的基色。
    
        \item 它的方块id是“minecraft:cobblestone\_slab[type=top,waterlogged=false]”，中括号里的方块状态指出这是个上半砖，且不含水；
    
        \item 它的中文名是“圆石上半砖”，英文名是“Cobblestone slab”；
    
        \item 它的图片是一个名为“cobblestone.png”的图片，这个图片放在CustomBlocks文件夹下；
    
        \item 它最早出现的版本为0，代表它在1.12之前就已经加入；
    
        \item 由于它的方块id在1.13发生了变化，它在1.12的方块id为idOld的值。

\end{enumerate}

    这段json中并没有显式列出方块的所有信息，其中needGlass、isGlowing、endermanPickable、burnable、wallUseable这些信息都使用了默认值，分别说明这个方块不需要依附其他方块、不发光、末影人偷不走、不可燃、可用于墙面像素画。

    \subsubsection{自己动手，丰衣足食}
    掌握以上信息后，就可以向自定义方块列表里写入任何你想要的方块了。步骤如下：

    \begin{enumerate}
        \item 将方块的图片做成16*16像素的png图片，放入CustomBlocks文件夹内。
        \item 将方块的json信息填入CustomBlocks.json中，注意json格式不要出错。
        \item 重启SlopeCraft，如果一切正常，你的方块将会成功加入到方块列表里；否则注意察看报错信息。
        \item 重复制作地图画的流程。
    \end{enumerate}

    \subsection{测试方块列表}
    投影中方块缺失基本上都是\textbf{id拼写错误}造成的。如果你一次性导入很多方块，这个功能可以快速测试出方块列表中每个方块有没有id错误。

    测试方块列表会生成一个特殊的结构方块文件，包含每种基色拥有的每一种可用方块（因版本不符合的除外）。结构文件中每个方块均按方块列表中的顺序排列。
    
    如果一切正常，不会有任何一个方块缺失；反之则说明对应的方块存在id错误。
    
    \begin{figure}[htbp]
        \centering
        \includegraphics[width=15cm]{Img9_TestBlockList.png}
        \caption{测试方块列表在高级菜单下}
        \label{locOfTestBlockList}
    \end{figure}

    设置好游戏版本后，点击菜单栏\textbf{高级}下的\textbf{测试方块列表}，选择保存这个结构方块文件的位置，如图\ref*{locOfTestBlockList}。SlopeCraft就会生成一个这样的结构方块文件。导入到游戏中即可，效果如图\ref*{testBlockListNBT}。

    \begin{figure}[htbp]
        \centering
        \subfigure[左半段]{
            \begin{minipage}[t]{7cm}
                \centering
                \includegraphics[width=6.5cm]{Img10_TestBlockList_Left.png}
            \end{minipage}
        }
        \subfigure[右半段]{
            \begin{minipage}[t]{7cm}
                \centering
                \includegraphics[width=6.5cm]{Img11_TestBlockList_Right.png}
            \end{minipage}
        }
        \caption{测试方块列表}
        \label{testBlockListNBT}
    \end{figure}

%\pagebreak
\section{下个版本}
    不出意外，下个版本v3.7将会加入以下功能：
    \begin{enumerate}
        \item 跟进Minecraft1.18
        \item 批量生成地图画
        \item 手动精修
        \item ……
    \end{enumerate}

\end{document}
